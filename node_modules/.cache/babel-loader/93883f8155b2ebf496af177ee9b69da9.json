{"remainingRequest":"E:\\XiangMu\\ant-design-pro-vue\\node_modules\\thread-loader\\dist\\cjs.js!E:\\XiangMu\\ant-design-pro-vue\\node_modules\\babel-loader\\lib\\index.js!E:\\XiangMu\\ant-design-pro-vue\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\XiangMu\\ant-design-pro-vue\\src\\components\\Table\\index.js","dependencies":[{"path":"E:\\XiangMu\\ant-design-pro-vue\\src\\components\\Table\\index.js","mtime":1565406523700},{"path":"E:\\XiangMu\\ant-design-pro-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XiangMu\\ant-design-pro-vue\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XiangMu\\ant-design-pro-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\XiangMu\\ant-design-pro-vue\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _mergeJSXProps from \"@vue/babel-helper-vue-jsx-merge-props\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _typeof from \"E:\\\\XiangMu\\\\ant-design-pro-vue\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/typeof\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"E:\\\\XiangMu\\\\ant-design-pro-vue\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.number.constructor\";\nimport T from 'ant-design-vue/es/table/Table';\nimport get from 'lodash.get';\nexport default {\n  data: function data() {\n    return {\n      needTotalList: [],\n      selectedRows: [],\n      selectedRowKeys: [],\n      localLoading: false,\n      localDataSource: [],\n      localPagination: Object.assign({}, this.pagination)\n    };\n  },\n  props: Object.assign({}, T.props, {\n    rowKey: {\n      type: [String, Function],\n      default: 'key'\n    },\n    data: {\n      type: Function,\n      required: true\n    },\n    pageNum: {\n      type: Number,\n      default: 1\n    },\n    pageSize: {\n      type: Number,\n      default: 10\n    },\n    showSizeChanger: {\n      type: Boolean,\n      default: true\n    },\n    size: {\n      type: String,\n      default: 'default'\n    },\n\n    /**\r\n     * alert: {\r\n     *   show: true,\r\n     *   clear: Function\r\n     * }\r\n     */\n    alert: {\n      type: [Object, Boolean],\n      default: null\n    },\n    rowSelection: {\n      type: Object,\n      default: null\n    },\n\n    /** @Deprecated */\n    showAlertInfo: {\n      type: Boolean,\n      default: false\n    },\n    showPagination: {\n      type: String | Boolean,\n      default: 'auto'\n    },\n\n    /**\r\n     * enable page URI mode\r\n     *\r\n     * e.g:\r\n     * /users/1\r\n     * /users/2\r\n     * /users/3?queryParam=test\r\n     * ...\r\n     */\n    pageURI: {\n      type: Boolean,\n      default: false\n    }\n  }),\n  watch: {\n    'localPagination.current': function localPaginationCurrent(val) {\n      this.pageURI && this.$router.push(_objectSpread({}, this.$route, {\n        name: this.$route.name,\n        params: Object.assign({}, this.$route.params, {\n          pageNo: val\n        })\n      }));\n    },\n    pageNum: function pageNum(val) {\n      Object.assign(this.localPagination, {\n        current: val\n      });\n    },\n    pageSize: function pageSize(val) {\n      Object.assign(this.localPagination, {\n        pageSize: val\n      });\n    },\n    showSizeChanger: function showSizeChanger(val) {\n      Object.assign(this.localPagination, {\n        showSizeChanger: val\n      });\n    }\n  },\n  created: function created() {\n    var pageNo = this.$route.params.pageNo;\n    var localPageNum = this.pageURI && pageNo && parseInt(pageNo) || this.pageNum;\n    this.localPagination = ['auto', true].includes(this.showPagination) && Object.assign({}, this.localPagination, {\n      current: localPageNum,\n      pageSize: this.pageSize,\n      showSizeChanger: this.showSizeChanger\n    }) || false;\n    console.log('this.localPagination', this.localPagination);\n    this.needTotalList = this.initTotalList(this.columns);\n    this.loadData();\n  },\n  methods: {\n    /**\r\n     * 表格重新加载方法\r\n     * 如果参数为 true, 则强制刷新到第一页\r\n     * @param Boolean bool\r\n     */\n    refresh: function refresh() {\n      var bool = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      bool && (this.localPagination = Object.assign({}, {\n        current: 1,\n        pageSize: this.pageSize\n      }));\n      this.loadData();\n    },\n\n    /**\r\n     * 加载数据方法\r\n     * @param {Object} pagination 分页选项器\r\n     * @param {Object} filters 过滤条件\r\n     * @param {Object} sorter 排序条件\r\n     */\n    loadData: function loadData(pagination, filters, sorter) {\n      var _this = this;\n\n      this.localLoading = true;\n      var parameter = Object.assign({\n        pageNo: pagination && pagination.current || this.showPagination && this.localPagination.current || this.pageNum,\n        pageSize: pagination && pagination.pageSize || this.showPagination && this.localPagination.pageSize || this.pageSize\n      }, sorter && sorter.field && {\n        sortField: sorter.field\n      } || {}, sorter && sorter.order && {\n        sortOrder: sorter.order\n      } || {}, _objectSpread({}, filters));\n      console.log('parameter', parameter);\n      var result = this.data(parameter); // 对接自己的通用数据接口需要修改下方代码中的 r.pageNo, r.totalCount, r.data\n      // eslint-disable-next-line\n\n      if ((_typeof(result) === 'object' || typeof result === 'function') && typeof result.then === 'function') {\n        result.then(function (r) {\n          _this.localPagination = _this.showPagination && Object.assign({}, _this.localPagination, {\n            current: r.pageNo,\n            // 返回结果中的当前分页数\n            total: r.totalCount,\n            // 返回结果中的总记录数\n            showSizeChanger: _this.showSizeChanger,\n            pageSize: pagination && pagination.pageSize || _this.localPagination.pageSize\n          }) || false; // 为防止删除数据后导致页面当前页面数据长度为 0 ,自动翻页到上一页\n\n          console.log(r.data);\n\n          if (r.data.length === 0 && _this.showPagination && _this.localPagination.current > 1) {\n            _this.localPagination.current--;\n\n            _this.loadData();\n\n            return;\n          } // 这里用于判断接口是否有返回 r.totalCount 且 this.showPagination = true 且 pageNo 和 pageSize 存在 且 totalCount 小于等于 pageNo * pageSize 的大小\n          // 当情况满足时，表示数据不满足分页大小，关闭 table 分页功能\n\n\n          try {\n            if (['auto', true].includes(_this.showPagination) && r.totalCount <= r.pageNo * _this.localPagination.pageSize) {\n              _this.localPagination.hideOnSinglePage = true;\n            }\n          } catch (e) {\n            _this.localPagination = false;\n          }\n\n          console.log('loadData -> this.localPagination', _this.localPagination);\n          _this.localDataSource = r.data; // 返回结果中的数组数据\n\n          _this.localLoading = false;\n        });\n      }\n    },\n    initTotalList: function initTotalList(columns) {\n      var totalList = [];\n      columns && columns instanceof Array && columns.forEach(function (column) {\n        if (column.needTotal) {\n          totalList.push(_objectSpread({}, column, {\n            total: 0\n          }));\n        }\n      });\n      return totalList;\n    },\n\n    /**\r\n     * 用于更新已选中的列表数据 total 统计\r\n     * @param selectedRowKeys\r\n     * @param selectedRows\r\n     */\n    updateSelect: function updateSelect(selectedRowKeys, selectedRows) {\n      this.selectedRows = selectedRows;\n      this.selectedRowKeys = selectedRowKeys;\n      var list = this.needTotalList;\n      this.needTotalList = list.map(function (item) {\n        return _objectSpread({}, item, {\n          total: selectedRows.reduce(function (sum, val) {\n            var total = sum + parseInt(get(val, item.dataIndex));\n            return isNaN(total) ? 0 : total;\n          }, 0)\n        });\n      });\n    },\n\n    /**\r\n     * 清空 table 已选中项\r\n     */\n    clearSelected: function clearSelected() {\n      if (this.rowSelection) {\n        this.rowSelection.onChange([], []);\n        this.updateSelect([], []);\n      }\n    },\n\n    /**\r\n     * 处理交给 table 使用者去处理 clear 事件时，内部选中统计同时调用\r\n     * @param callback\r\n     * @returns {*}\r\n     */\n    renderClear: function renderClear(callback) {\n      var _this2 = this;\n\n      var h = this.$createElement;\n      if (this.selectedRowKeys.length <= 0) return null;\n      return h(\"a\", {\n        \"style\": \"margin-left: 24px\",\n        \"on\": {\n          \"click\": function click() {\n            callback();\n\n            _this2.clearSelected();\n          }\n        }\n      }, [\"\\u6E05\\u7A7A\"]);\n    },\n    renderAlert: function renderAlert() {\n      var h = this.$createElement;\n      // 绘制统计列数据\n      var needTotalItems = this.needTotalList.map(function (item) {\n        return h(\"span\", {\n          \"style\": \"margin-right: 12px\"\n        }, [item.title, \"\\u603B\\u8BA1 \", h(\"a\", {\n          \"style\": \"font-weight: 600\"\n        }, [!item.customRender ? item.total : item.customRender(item.total)])]);\n      }); // 绘制 清空 按钮\n\n      var clearItem = typeof this.alert.clear === 'boolean' && this.alert.clear ? this.renderClear(this.clearSelected) : this.alert !== null && typeof this.alert.clear === 'function' ? this.renderClear(this.alert.clear) : null; // 绘制 alert 组件\n\n      return h(\"a-alert\", {\n        \"attrs\": {\n          \"showIcon\": true\n        },\n        \"style\": \"margin-bottom: 16px\"\n      }, [h(\"template\", {\n        \"slot\": \"message\"\n      }, [h(\"span\", {\n        \"style\": \"margin-right: 12px\"\n      }, [\"\\u5DF2\\u9009\\u62E9: \", h(\"a\", {\n        \"style\": \"font-weight: 600\"\n      }, [this.selectedRows.length])]), needTotalItems, clearItem])]);\n    }\n  },\n  render: function render() {\n    var _this3 = this;\n\n    var h = arguments[0];\n    var props = {};\n    var localKeys = Object.keys(this.$data);\n    var showAlert = _typeof(this.alert) === 'object' && this.alert !== null && this.alert.show && typeof this.rowSelection.selectedRowKeys !== 'undefined' || this.alert;\n    Object.keys(T.props).forEach(function (k) {\n      var localKey = \"local\".concat(k.substring(0, 1).toUpperCase()).concat(k.substring(1));\n\n      if (localKeys.includes(localKey)) {\n        props[k] = _this3[localKey];\n        return props[k];\n      }\n\n      if (k === 'rowSelection') {\n        if (showAlert && _this3.rowSelection) {\n          // 如果需要使用alert，则重新绑定 rowSelection 事件\n          console.log('this.rowSelection', _this3.rowSelection);\n          props[k] = _objectSpread({}, _this3.rowSelection, {\n            selectedRows: _this3.selectedRows,\n            selectedRowKeys: _this3.selectedRowKeys,\n            onChange: function onChange(selectedRowKeys, selectedRows) {\n              _this3.updateSelect(selectedRowKeys, selectedRows);\n\n              typeof _this3[k].onChange !== 'undefined' && _this3[k].onChange(selectedRowKeys, selectedRows);\n            }\n          });\n          return props[k];\n        } else if (!_this3.rowSelection) {\n          // 如果没打算开启 rowSelection 则清空默认的选择项\n          props[k] = null;\n          return props[k];\n        }\n      }\n\n      _this3[k] && (props[k] = _this3[k]);\n      return props[k];\n    });\n    var table = h(\"a-table\", _mergeJSXProps([{}, {\n      props: props,\n      scopedSlots: _objectSpread({}, this.$scopedSlots)\n    }, {\n      \"on\": {\n        \"change\": this.loadData\n      }\n    }]), [Object.keys(this.$slots).map(function (name) {\n      return h(\"template\", {\n        \"slot\": name\n      }, [_this3.$slots[name]]);\n    })]);\n    return h(\"div\", {\n      \"class\": \"table-wrapper\"\n    }, [showAlert ? this.renderAlert() : null, table]);\n  }\n};",null]}