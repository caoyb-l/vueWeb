{"remainingRequest":"/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/src/views/robot/modules/CreateImage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/src/views/robot/modules/CreateImage.vue","mtime":1575082421410},{"path":"/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/node_modules/cache-loader/dist/cjs.js","mtime":1571637271763},{"path":"/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/node_modules/thread-loader/dist/cjs.js","mtime":1571637441620},{"path":"/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/node_modules/babel-loader/lib/index.js","mtime":1571637266900},{"path":"/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/node_modules/cache-loader/dist/cjs.js","mtime":1571637271763},{"path":"/Users/cyb/work/KaiFa/cz_workSpace/robotWeb/node_modules/vue-loader/lib/index.js","mtime":1571637450640}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { queryData, addData } from '@/api/common'\r\nimport { STable } from '@/components'\r\nexport default {\r\n  components: {\r\n    STable\r\n  },\r\n  data() {\r\n    return {\r\n      showEditCmd: false,\r\n      labelCol: {\r\n        xs: { span: 24 },\r\n        sm: { span: 7 }\r\n      },\r\n      wrapperCol: {\r\n        xs: { span: 24 },\r\n        sm: { span: 13 }\r\n      },\r\n      visible: false,\r\n      updataVisible: false,\r\n      descnVisible: false, //备注是否隐藏\r\n\r\n      confirmLoading: false,\r\n      form: this.$form.createForm(this),\r\n      fileList: [],\r\n      fileName: '', //文件名\r\n      name: '', //图片名称\r\n      appImageVisible: false,\r\n      appImageWebUrl: '', //图片访问地址\r\n      descn: '', //选择网页时的备注\r\n      typeId: '',\r\n      imageTypeList: [\r\n        {\r\n          typeId: 0,\r\n          type: '开机'\r\n        },\r\n        {\r\n          typeId: 1,\r\n          type: '休息'\r\n        },\r\n        {\r\n          typeId: 2,\r\n          type: 'LOGO'\r\n        },\r\n        {\r\n          typeId: 3,\r\n          type: '主页'\r\n        }\r\n      ],\r\n      imageList: [\r\n        {\r\n          fileName: '123456.png',\r\n          name: '党建待机（创创）'\r\n        },\r\n        {\r\n          fileName: '123457.png',\r\n          name: '教育待机（创创）'\r\n        },\r\n        {\r\n          fileName: '123458.png',\r\n          name: '医疗待机（创创）'\r\n        },\r\n        {\r\n          fileName: '123459.png',\r\n          name: '政务待机（创创）'\r\n        }\r\n      ],\r\n      // 表头\r\n      columns: [\r\n        {\r\n          title: '#',\r\n          dataIndex: 'no',\r\n          scopedSlots: { customRender: 'serial' }\r\n        },\r\n\r\n        {\r\n          title: '机器人名称',\r\n          dataIndex: 'name',\r\n          scopedSlots: { customRender: 'name' }\r\n        },\r\n        {\r\n          title: '机器人编码',\r\n          dataIndex: 'code',\r\n          scopedSlots: { customRender: 'code' }\r\n        }\r\n      ],\r\n      // 加载数据方法 必须为 Promise 对象\r\n      loadData: parameter => {\r\n        var id = JSON.parse(localStorage.getItem('user')).id\r\n        var orgId = JSON.parse(localStorage.getItem('user')).orgId\r\n        console.log('user 请求', parameter)\r\n        var params = {\r\n          type: 1, //判断标识 新增操作传1 修改操作传2\r\n          imageType: this.typeId,\r\n          code: '',\r\n          orgId: orgId,\r\n          userId: id\r\n        }\r\n        return queryData(Object.assign(parameter, params), '/robotInfo/loadRobotPageListByAppImage').then(res => {\r\n          console.log(res)\r\n          return res.result\r\n        })\r\n      },\r\n      selectedRowKeys: new Set([]),\r\n      selectedRows: [],\r\n      options: {\r\n        alert: {\r\n          show: true\r\n        },\r\n        rowSelection: {\r\n          onSelect: this.onSelectChange,\r\n          onSelectAll: this.onSelectChangeAll\r\n        }\r\n      },\r\n      optionAlertShow: false\r\n    }\r\n  },\r\n  created() {},\r\n  methods: {\r\n    //类型选择列表监听事件\r\n    handleAppImageChange(value) {\r\n      this.typeId = value\r\n      if (value == 3) {\r\n        ;(this.descnVisible = true), (this.updataVisible = false)\r\n      } else {\r\n        ;(this.descnVisible = false), (this.updataVisible = true)\r\n      } //选择网页的时候会弹出备注选择项\r\n      this.$refs.table.refresh()\r\n    },\r\n    //公共图片选择列表监听事件\r\n    handleAppImageChange2(value) {\r\n      this.fileName = value\r\n    },\r\n    filterOption(input, option) {\r\n      return option.componentOptions.children[0].text.toLowerCase().indexOf(input.toLowerCase()) >= 0\r\n    },\r\n    // 选择机器人\r\n    onSelectChange(record, selected, selectedRows, nativeEvent) {\r\n      console.log(record, selected)\r\n      if (selected) {\r\n        this.selectedRowKeys.add(record.id)\r\n      } else {\r\n        this.selectedRowKeys.delete(record.id)\r\n      }\r\n    },\r\n    onSelectChangeAll(selected, selectedRows, changeRows) {\r\n      if (selected) {\r\n        changeRows.map((value, index) => {\r\n          this.selectedRowKeys.add(value.id)\r\n        })\r\n      } else {\r\n        changeRows.map((value, index) => {\r\n          this.selectedRowKeys.delete(value.id)\r\n        })\r\n      }\r\n    },\r\n\r\n    add() {\r\n      this.visible = true\r\n      this.selectedRowKeys.clear()\r\n    },\r\n\r\n    handleSubmit() {\r\n      let org = JSON.parse(localStorage.getItem('user')).orgId\r\n      const {\r\n        form: { validateFields }\r\n      } = this\r\n      var _this = this\r\n      this.confirmLoading = true\r\n      validateFields((errors, values) => {\r\n        if (!errors) {\r\n          if (this.fileName == '' && this.typeId != 3) {\r\n            this.$message.error('请上传图片')\r\n            return\r\n          }\r\n          var param = {\r\n            robotId: [..._this.selectedRowKeys],\r\n            fileName: this.fileName, //文件名\r\n            orgId: org,\r\n            type: this.typeId, //文件类型\r\n            descn: this.descn, //网页备注\r\n            name: this.name //图片名称\r\n          }\r\n          queryData({ ...param, ...values }, '/appImage/save').then(res => {\r\n            if (res.code == 0) {\r\n              _this.$message.success('新建成功')\r\n              this.typeId = ''\r\n            } else {\r\n              _this.$message.error(res.message)\r\n            }\r\n            _this.fileList = []\r\n            _this.visible = false\r\n            _this.confirmLoading = false\r\n            _this.$emit('ok', values)\r\n            // 重置输入框内容\r\n            _this.form.resetFields()\r\n          })\r\n        } else {\r\n          this.confirmLoading = false\r\n        }\r\n      })\r\n    },\r\n    handlePreview(file) {\r\n      console.log(file)\r\n      this.appImageWebUrl = file.url || file.thumbUrl\r\n      this.appImageVisible = true\r\n    },\r\n    //文件长传监听\r\n    handleChange({ fileList }) {\r\n      if (fileList.length > 0) {\r\n        if (fileList[0].status == 'done') {\r\n          var res = fileList[0].response\r\n          console.log(res)\r\n          if (res.code == 0) {\r\n            this.fileName = res.fileName\r\n            this.$message.success(`${res.fileName} 上传成功`)\r\n          } else {\r\n            this.$message.error(res.message)\r\n          }\r\n        }\r\n      }\r\n      this.fileList = fileList\r\n    },\r\n    // 删除文件\r\n    handleRemoveFile(file) {\r\n      let _this = this\r\n      queryData({ fileName: file.response.fileName }, '/appImage/delFile').then(res => {\r\n        if (res.code == 0) {\r\n          _this.$message.error(res.message)\r\n          return true\r\n        } else {\r\n          _this.$message.error(res.message)\r\n          return false\r\n        }\r\n      })\r\n    },\r\n    handleCancel() {\r\n      this.appImageVisible = false\r\n    }\r\n  }\r\n}\r\n",null]}