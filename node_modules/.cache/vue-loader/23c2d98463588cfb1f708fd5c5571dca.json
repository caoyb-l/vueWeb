{"remainingRequest":"D:\\antd_vue\\ant-design-pro-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\antd_vue\\ant-design-pro-vue\\src\\views\\instruction\\modules\\EditAllSensor.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\antd_vue\\ant-design-pro-vue\\src\\views\\instruction\\modules\\EditAllSensor.vue","mtime":1566376233533},{"path":"D:\\antd_vue\\ant-design-pro-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1562295152232},{"path":"D:\\antd_vue\\ant-design-pro-vue\\node_modules\\@vue\\cli-plugin-babel\\node_modules\\babel-loader\\lib\\index.js","mtime":1562032167570},{"path":"D:\\antd_vue\\ant-design-pro-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1562295152232},{"path":"D:\\antd_vue\\ant-design-pro-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1562295154751}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { queryData, addData } from '@/api/common'\r\nimport { STable } from '@/components'\r\nexport default {\r\n  components: {\r\n    STable\r\n  },\r\n  data() {\r\n    return {\r\n      labelCol: {\r\n        xs: { span: 24 },\r\n        sm: { span: 7 }\r\n      },\r\n      wrapperCol: {\r\n        xs: { span: 24 },\r\n        sm: { span: 13 }\r\n      },\r\n      visible: false,\r\n      confirmLoading: false,\r\n      form: this.$form.createForm(this),\r\n      triggerCmdList: [],\r\n      cmdList: [],\r\n     triggerId:\"\",\r\n      queryParam:{},\r\n      // 表头\r\n      columns: [\r\n        {\r\n          title: '#',\r\n          dataIndex: 'no',\r\n          scopedSlots: { customRender: 'serial' }\r\n        },\r\n\r\n        {\r\n          title: '机器人名称',\r\n          dataIndex: 'name',\r\n          scopedSlots: { customRender: 'name' }\r\n        },\r\n        {\r\n          title: '机器人编码',\r\n          dataIndex: 'code',\r\n          scopedSlots: { customRender: 'code' }\r\n        }\r\n      ],\r\n      // 加载数据方法 必须为 Promise 对象\r\n      loadData: parameter => {\r\n        var id = JSON.parse(localStorage.getItem('user')).id\r\n        console.log('user 请求', parameter)\r\n        var params = {\r\n          type: 2,\r\n          triggerId: this.triggerId,\r\n          code: '',\r\n          name: '',\r\n          orgId: '',\r\n          userId: id,        \r\n          validityDate: ''\r\n        }\r\n        return queryData(\r\n          Object.assign(parameter, params, this.queryParam),\r\n          '/robotInfo/loadPageListByTruggerRobot'\r\n        ).then(res => {\r\n          console.log(res)\r\n          return res.result\r\n        })\r\n      },\r\n      selectedRowKeys: new Set([]),\r\n      selectedRows: [],\r\n      options: {\r\n        alert: {\r\n          show: true\r\n        },\r\n        rowSelection: {             \r\n          onSelect:this.onSelectChange,\r\n          onSelectAll:this.onSelectChangeAll\r\n        }\r\n      },\r\n      optionAlertShow: false\r\n    }\r\n  },\r\n  created() {},\r\n  methods: {\r\n   \r\n    handleTriggerCmdChange(value) {\r\n      console.log(`selected ${value}`)\r\n      this.triggerId=value;\r\n        this.$refs.table.refresh()\r\n    },\r\n    filterOption(input, option) {\r\n      return option.componentOptions.children[0].text.toLowerCase().indexOf(input.toLowerCase()) >= 0\r\n    },\r\n    //选择机器人\r\n    onSelectChange (record, selected, selectedRows, nativeEvent) {       \r\n        if(selected){\r\n            this.selectedRowKeys.add(record.id)           \r\n        }else{\r\n             this.selectedRowKeys.delete(record.id)\r\n        }\r\n   \r\n    },\r\n    onSelectChangeAll(selected, selectedRows, changeRows){\r\n     if(selected){           \r\n             changeRows.map((value,index)=>{\r\n                 this.selectedRowKeys.add(value.id)   \r\n             })       \r\n        }else{           \r\n             changeRows.map((value,index)=>{\r\n                 this.selectedRowKeys.delete(value.id)   \r\n             })   \r\n        }\r\n    },\r\n    //获取指令列表\r\n    getTriggerCmdList() {\r\n      var _this = this;      \r\n      queryData({}, '/supercmdTrigger/getSupercmdTriggerList').then(res => {\r\n        console.log('指令列表', res)\r\n        if (res.code == 0) {\r\n          _this.triggerCmdList = res.supercmdTriggerList\r\n        } else {\r\n          _this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n //获取命令集\r\n    getCmdList() {\r\n      var _this = this\r\n       var id = JSON.parse(localStorage.getItem('user')).id\r\n       var param={ \"orgId\": id}\r\n      queryData(param, '/cmdCollection/getCmdListByOrg').then(res => {\r\n        console.log('命令集', res)\r\n        if (res.code == 0) {\r\n          _this.cmdList = res.cmdList\r\n        } else {\r\n          _this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n\r\n    add() {\r\n      this.visible = true\r\n      this.getTriggerCmdList()\r\n      this.getCmdList()\r\n        this.selectedRowKeys.clear();           \r\n      if(this.$refs.table){\r\n          this.$refs.table.refresh()\r\n       }   \r\n    },\r\n\r\n    handleSubmit() {\r\n      const {\r\n        form: { validateFields }\r\n      } = this\r\n      var _this = this\r\n      this.confirmLoading = true\r\n      validateFields((errors, values) => {\r\n        if (!errors) {\r\n          var param = {\r\n            robotId: [..._this.selectedRowKeys],\r\n            cmdId: '1'\r\n          }\r\n          queryData({ ...param, ...values }, '/supercmdTriggerRobot/updateAll').then(res => {\r\n            if (res.code == 0) {\r\n              _this.$message.success('新建成功')\r\n            } else {\r\n              _this.$message.error(res.message)\r\n            }\r\n            _this.visible = false\r\n            _this.confirmLoading = false\r\n            _this.$emit('ok', values)\r\n            // 重置输入框内容\r\n            _this.form.resetFields()\r\n          })\r\n        } else {\r\n          this.confirmLoading = false\r\n        }\r\n      })\r\n    },\r\n    handleCancel() {\r\n      this.visible = false\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["EditAllSensor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditAllSensor.vue","sourceRoot":"src/views/instruction/modules","sourcesContent":["<template>\r\n  <!-- 新增弹框 -->\r\n  <a-modal title=\"新建\" style=\"top: 20px;\" :width=\"'70%'\" v-model=\"visible\" @ok=\"handleSubmit\" :destroyOnClose=\"true\">\r\n    <a-form :form=\"form\">\r\n      <a-form-item label=\"触发指令\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\r\n        <a-select\r\n          showSearch\r\n          placeholder=\"选择触发指令\"\r\n          optionFilterProp=\"children\"\r\n          style=\"width: 200px\"\r\n          @change=\"handleTriggerCmdChange\"\r\n          :filterOption=\"filterOption\"\r\n          v-decorator=\"[\r\n            'triggerId',\r\n            {rules: [{required: true,  message: '选择触发指令' }]}\r\n          ]\"\r\n        >\r\n          <a-select-option\r\n            v-for=\"(item) in triggerCmdList\"\r\n            :key=\"item.id\"\r\n            :value=\"item.id\"\r\n          >{{item.triggerName}}</a-select-option>\r\n        </a-select>\r\n      </a-form-item>\r\n      <a-form-item label=\"选择机器人\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\r\n        <s-table\r\n          ref=\"table\"\r\n          size=\"default\"\r\n          rowKey=\"id\"\r\n          :columns=\"columns\"\r\n          :data=\"loadData\"\r\n          :alert=\"options.alert\"\r\n          :rowSelection=\"options.rowSelection\"\r\n          showPagination=\"auto\"\r\n        >\r\n          <span slot=\"serial\" slot-scope=\"text, record, index\">{{ index + 1 }}</span>\r\n        </s-table>\r\n      </a-form-item>\r\n      <a-form-item label=\"命令集\" :labelCol=\"labelCol\" :wrapperCol=\"wrapperCol\">\r\n           <a-select\r\n          showSearch\r\n          placeholder=\"选择命令集\"\r\n          optionFilterProp=\"children\"\r\n          style=\"width: 200px\"         \r\n          :filterOption=\"filterOption\"\r\n          v-decorator=\"[\r\n            'cmdId',\r\n            {rules: [{required: true,  message: '选择命令集' }]}\r\n          ]\"\r\n        >\r\n          <a-select-option\r\n            v-for=\"(item) in cmdList\"\r\n            :key=\"item.id\"\r\n            :value=\"item.id\"\r\n          >{{item.name}}</a-select-option>\r\n        </a-select>\r\n        <a-button type=\"primary\" style=\"margin-left:20px\">设置命令集</a-button>\r\n      </a-form-item>\r\n    </a-form>\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\nimport { queryData, addData } from '@/api/common'\r\nimport { STable } from '@/components'\r\nexport default {\r\n  components: {\r\n    STable\r\n  },\r\n  data() {\r\n    return {\r\n      labelCol: {\r\n        xs: { span: 24 },\r\n        sm: { span: 7 }\r\n      },\r\n      wrapperCol: {\r\n        xs: { span: 24 },\r\n        sm: { span: 13 }\r\n      },\r\n      visible: false,\r\n      confirmLoading: false,\r\n      form: this.$form.createForm(this),\r\n      triggerCmdList: [],\r\n      cmdList: [],\r\n     triggerId:\"\",\r\n      queryParam:{},\r\n      // 表头\r\n      columns: [\r\n        {\r\n          title: '#',\r\n          dataIndex: 'no',\r\n          scopedSlots: { customRender: 'serial' }\r\n        },\r\n\r\n        {\r\n          title: '机器人名称',\r\n          dataIndex: 'name',\r\n          scopedSlots: { customRender: 'name' }\r\n        },\r\n        {\r\n          title: '机器人编码',\r\n          dataIndex: 'code',\r\n          scopedSlots: { customRender: 'code' }\r\n        }\r\n      ],\r\n      // 加载数据方法 必须为 Promise 对象\r\n      loadData: parameter => {\r\n        var id = JSON.parse(localStorage.getItem('user')).id\r\n        console.log('user 请求', parameter)\r\n        var params = {\r\n          type: 2,\r\n          triggerId: this.triggerId,\r\n          code: '',\r\n          name: '',\r\n          orgId: '',\r\n          userId: id,        \r\n          validityDate: ''\r\n        }\r\n        return queryData(\r\n          Object.assign(parameter, params, this.queryParam),\r\n          '/robotInfo/loadPageListByTruggerRobot'\r\n        ).then(res => {\r\n          console.log(res)\r\n          return res.result\r\n        })\r\n      },\r\n      selectedRowKeys: new Set([]),\r\n      selectedRows: [],\r\n      options: {\r\n        alert: {\r\n          show: true\r\n        },\r\n        rowSelection: {             \r\n          onSelect:this.onSelectChange,\r\n          onSelectAll:this.onSelectChangeAll\r\n        }\r\n      },\r\n      optionAlertShow: false\r\n    }\r\n  },\r\n  created() {},\r\n  methods: {\r\n   \r\n    handleTriggerCmdChange(value) {\r\n      console.log(`selected ${value}`)\r\n      this.triggerId=value;\r\n        this.$refs.table.refresh()\r\n    },\r\n    filterOption(input, option) {\r\n      return option.componentOptions.children[0].text.toLowerCase().indexOf(input.toLowerCase()) >= 0\r\n    },\r\n    //选择机器人\r\n    onSelectChange (record, selected, selectedRows, nativeEvent) {       \r\n        if(selected){\r\n            this.selectedRowKeys.add(record.id)           \r\n        }else{\r\n             this.selectedRowKeys.delete(record.id)\r\n        }\r\n   \r\n    },\r\n    onSelectChangeAll(selected, selectedRows, changeRows){\r\n     if(selected){           \r\n             changeRows.map((value,index)=>{\r\n                 this.selectedRowKeys.add(value.id)   \r\n             })       \r\n        }else{           \r\n             changeRows.map((value,index)=>{\r\n                 this.selectedRowKeys.delete(value.id)   \r\n             })   \r\n        }\r\n    },\r\n    //获取指令列表\r\n    getTriggerCmdList() {\r\n      var _this = this;      \r\n      queryData({}, '/supercmdTrigger/getSupercmdTriggerList').then(res => {\r\n        console.log('指令列表', res)\r\n        if (res.code == 0) {\r\n          _this.triggerCmdList = res.supercmdTriggerList\r\n        } else {\r\n          _this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n //获取命令集\r\n    getCmdList() {\r\n      var _this = this\r\n       var id = JSON.parse(localStorage.getItem('user')).id\r\n       var param={ \"orgId\": id}\r\n      queryData(param, '/cmdCollection/getCmdListByOrg').then(res => {\r\n        console.log('命令集', res)\r\n        if (res.code == 0) {\r\n          _this.cmdList = res.cmdList\r\n        } else {\r\n          _this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n\r\n    add() {\r\n      this.visible = true\r\n      this.getTriggerCmdList()\r\n      this.getCmdList()\r\n        this.selectedRowKeys.clear();           \r\n      if(this.$refs.table){\r\n          this.$refs.table.refresh()\r\n       }   \r\n    },\r\n\r\n    handleSubmit() {\r\n      const {\r\n        form: { validateFields }\r\n      } = this\r\n      var _this = this\r\n      this.confirmLoading = true\r\n      validateFields((errors, values) => {\r\n        if (!errors) {\r\n          var param = {\r\n            robotId: [..._this.selectedRowKeys],\r\n            cmdId: '1'\r\n          }\r\n          queryData({ ...param, ...values }, '/supercmdTriggerRobot/updateAll').then(res => {\r\n            if (res.code == 0) {\r\n              _this.$message.success('新建成功')\r\n            } else {\r\n              _this.$message.error(res.message)\r\n            }\r\n            _this.visible = false\r\n            _this.confirmLoading = false\r\n            _this.$emit('ok', values)\r\n            // 重置输入框内容\r\n            _this.form.resetFields()\r\n          })\r\n        } else {\r\n          this.confirmLoading = false\r\n        }\r\n      })\r\n    },\r\n    handleCancel() {\r\n      this.visible = false\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}